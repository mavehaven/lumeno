<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Understanding Differentials: A Comprehensive Guide</title>
  <!-- MathJS for calculations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
  <!-- MathJax for rendering LaTeX -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
  <style>
    /* Enhanced CSS styling */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f8f9fa;
      line-height: 1.6;
      color: #333;
    }
    h1, h2, h3 {
      text-align: center;
      color: #2c3e50;
    }
    h1 {
      border-bottom: 2px solid #3498db;
      padding-bottom: 10px;
    }
    .section {
      background-color: #fff;
      padding: 25px;
      margin-bottom: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .canvas-container {
      margin: 20px 0;
      text-align: center;
      position: relative;
    }
    canvas {
      border: 1px solid #ddd;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .controls {
      margin: 15px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
    }
    .calculations {
      margin: 15px 0;
      padding: 15px;
      background: #e9ecef;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 1.1em;
    }
    button {
      padding: 10px 18px;
      margin: 0 5px;
      background: #3498db;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }
    button:hover {
      background: #2980b9;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .slider {
      width: 200px;
      margin: 10px;
    }
    .concept {
      display: none;
    }
    .concept.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .navigation {
      text-align: center;
      margin: 25px 0;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .navigation button {
      background: #2c3e50;
    }
    .navigation button:hover {
      background: #1a252f;
    }
    .explanation {
      background: #f8f9fa;
      padding: 15px;
      border-left: 4px solid #3498db;
      margin: 15px 0;
      border-radius: 0 8px 8px 0;
    }
    .real-world {
      background: #e8f4fd;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
    }
    .real-world h4 {
      color: #2980b9;
      margin-top: 0;
    }
    .step-by-step {
      background: #fff5e6;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
    }
    .step-by-step h4 {
      color: #e67e22;
      margin-top: 0;
    }
    .formula {
      text-align: center;
      font-size: 1.2em;
      margin: 15px 0;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
    }
    .progress-bar {
      height: 5px;
      background: #e0e0e0;
      border-radius: 5px;
      margin: 10px 0;
      overflow: hidden;
    }
    .progress {
      height: 100%;
      background: #3498db;
      width: 0%;
      transition: width 0.5s ease;
    }
    .tooltip {
      position: relative;
      display: inline-block;
      border-bottom: 1px dotted #3498db;
      cursor: help;
    }
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 200px;
      background-color: #2c3e50;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 10px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -100px;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }
    .comparison-table th, .comparison-table td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    .comparison-table th {
      background-color: #3498db;
      color: white;
    }
    .comparison-table tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    input[type="text"] {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1em;
    }
    select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <h1>Understanding Differentials: From Slopes to Derivatives</h1>
  <p style="text-align: center; font-size: 1.1em;">A comprehensive guide exploring the concepts from basic slopes to derivatives with interactive examples, real-world applications, and step-by-step explanations.</p>
  
  <div class="progress-bar">
    <div class="progress" id="progressBar"></div>
  </div>
  
  <div class="navigation">
    <button onclick="showConcept('introduction')">Introduction</button>
    <button onclick="showConcept('basic')">Basic Slopes</button>
    <button onclick="showConcept('change')">Rate of Change</button>
    <button onclick="showConcept('limit')">Limits</button>
    <button onclick="showConcept('derivative')">Derivatives</button>
    <button onclick="showConcept('applications')">Applications</button>
    <button onclick="showConcept('practice')">Practice Problems</button>
  </div>

  <!-- Introduction Section -->
  <div id="introduction" class="concept section active">
    <h2>Introduction to Calculus and Differentials</h2>
    <p>Calculus is the mathematical study of continuous change, and differential calculus focuses on the concept of the derivative, which represents the rate at which a quantity changes.</p>
    
    <div class="explanation">
      <h3>Why Study Differentials?</h3>
      <p>Differentials help us understand:</p>
      <ul>
        <li>How things change over time (velocity, growth rates)</li>
        <li>Optimal solutions to problems (maximizing profit, minimizing cost)</li>
        <li>The behavior of complex systems (physics, engineering, economics)</li>
        <li>Approximations of complex functions</li>
      </ul>
    </div>
    
    <div class="real-world">
      <h4>Real-World Applications</h4>
      <p>Differentials are used in:</p>
      <ul>
        <li><strong>Physics:</strong> Calculating velocity and acceleration from position</li>
        <li><strong>Economics:</strong> Finding marginal cost and revenue</li>
        <li><strong>Engineering:</strong> Optimizing designs and systems</li>
        <li><strong>Medicine:</strong> Modeling drug concentration in the bloodstream</li>
        <li><strong>Computer Science:</strong> Training machine learning models</li>
      </ul>
    </div>
    
    <div class="step-by-step">
      <h4>What You'll Learn</h4>
      <p>This tutorial will guide you through:</p>
      <ol>
        <li>Understanding slopes of straight lines</li>
        <li>Calculating rates of change for curves</li>
        <li>Grasping the concept of limits</li>
        <li>Defining and calculating derivatives</li>
        <li>Applying derivatives to real-world problems</li>
      </ol>
    </div>
    
    <div class="formula">
      The derivative of a function \( f(x) \) at point \( x \) is defined as:
      \[ f'(x) = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h} \]
    </div>
  </div>

  <!-- Basic Slopes Section -->
  <div id="basic" class="concept section">
    <h2>1. Understanding Slopes</h2>
    <p>
      The slope of a line measures its steepness and direction. It's defined as the ratio of the vertical change (rise) to the horizontal change (run) between any two points on the line.
    </p>
    
    <div class="formula">
      \[ m = \frac{\Delta y}{\Delta x} = \frac{y_2 - y_1}{x_2 - x_1} \]
    </div>
    
    <div class="explanation">
      <h3>Interpreting Slope Values</h3>
      <ul>
        <li><strong>Positive slope:</strong> Line rises from left to right</li>
        <li><strong>Negative slope:</strong> Line falls from left to right</li>
        <li><strong>Zero slope:</strong> Horizontal line</li>
        <li><strong>Undefined slope:</strong> Vertical line</li>
      </ul>
    </div>
    
    <div class="controls">
      <label>Adjust slope:</label>
      <input type="range" min="-20" max="20" value="1" class="slider" id="slopeSlider">
      <span id="slopeValue">1</span>
      <button onclick="addPointToSlope()">Add Point Coordinates</button>
    </div>
    
    <div class="calculations" id="slopeCalculations">
      <div>Rise: <span id="riseValue">0</span></div>
      <div>Run: <span id="runValue">0</span></div>
      <div>Slope (\( m \)): <span id="slopeMValue">0</span></div>
      <div>Equation: <span id="slopeEquation">\( x \)</span></div>
      <div id="pointCoordinates"></div>
    </div>
    
    <div class="canvas-container">
      <canvas id="slopeCanvas" width="500" height="350"></canvas>
    </div>
    
    <div class="step-by-step">
      <h4>Step-by-Step: Calculating Slope</h4>
      <p>Let's calculate the slope between two points:</p>
      <ol>
        <li>Select two points on the line: (x₁, y₁) and (x₂, y₂)</li>
        <li>Calculate the difference in y-values: Δy = y₂ - y₁</li>
        <li>Calculate the difference in x-values: Δx = x₂ - x₁</li>
        <li>Divide Δy by Δx: m = Δy/Δx</li>
      </ol>
    </div>
  </div>

  <!-- Rate of Change Section -->
  <div id="change" class="concept section">
    <h2>2. Rate of Change</h2>
    <p>
      While straight lines have constant slopes, curves have changing slopes. The rate of change measures how a quantity changes over time or with respect to another variable.
    </p>
    
    <div class="formula">
      Average Rate of Change = \( \frac{f(b) - f(a)}{b - a} \)
    </div>
    
    <div class="explanation">
      <h3>Average vs. Instantaneous Rate of Change</h3>
      <p>The average rate of change gives the slope of the secant line between two points, while the instantaneous rate of change (derivative) gives the slope of the tangent line at a single point.</p>
    </div>
    
    <div class="controls">
      <label>Select function: </label>
      <select id="functionSelect">
        <option value="quadratic">Quadratic \( (x^2) \)</option>
        <option value="cubic">Cubic \( (x^3) \)</option>
        <option value="sinusoidal">Sinusoidal \( (\sin(x)) \)</option>
        <option value="exponential">Exponential \( (e^x) \)</option>
        <option value="logarithmic">Logarithmic \( (\ln|x|) \)</option>
      </select>
      <label>Point A (x): </label>
      <input type="range" min="-5" max="5" value="-2" step="0.1" class="slider" id="pointASlider">
      <span id="pointAValue">-2</span>
      <label>Point B (x): </label>
      <input type="range" min="-5" max="5" value="2" step="0.1" class="slider" id="pointBSlider">
      <span id="pointBValue">2</span>
    </div>
    
    <div class="calculations" id="rateCalculations">
      <div>Point A: (<span id="pointAX">-2</span>, <span id="pointAY">0</span>)</div>
      <div>Point B: (<span id="pointBX">2</span>, <span id="pointBY">0</span>)</div>
      <div>Rise: <span id="rateRise">0</span></div>
      <div>Run: <span id="rateRun">0</span></div>
      <div>Average Rate of Change: <span id="averageRate">0</span></div>
    </div>
    
    <div class="canvas-container">
      <canvas id="rateCanvas" width="500" height="350"></canvas>
    </div>
    
    <div class="real-world">
      <h4>Real-World Example: Position vs. Time</h4>
      <p>If this graph represented position over time, the average rate of change would represent the average velocity between two points in time.</p>
    </div>
  </div>

  <!-- Limits Section -->
  <div id="limit" class="concept section">
    <h2>3. Understanding Limits</h2>
    <p>
      Limits help us understand what happens to a function as we approach a specific point, even if the function is not defined at that point.
    </p>
    
    <div class="formula">
      \[ \lim_{x \to c} f(x) = L \]
    </div>
    
    <div class="explanation">
      <h3>Why Limits Matter</h3>
      <p>Limits are fundamental to calculus because they allow us to:</p>
      <ul>
        <li>Define derivatives and integrals</li>
        <li>Analyze function behavior near points of discontinuity</li>
        <li>Understand infinite processes</li>
        <li>Calculate instantaneous rates of change</li>
      </ul>
    </div>
    
    <div class="controls">
      <label>Select function: </label>
      <select id="limitFunctionSelect">
        <option value="continuous">Continuous \( (x^2) \)</option>
        <option value="discontinuous">Discontinuous \( \frac{x^2-4}{x-2} \)</option>
        <option value="oscillating">Oscillating \( \sin(1/x) \)</option>
      </select>
      <label>Point to approach: </label>
      <input type="range" min="-5" max="5" value="0" step="0.1" class="slider" id="limitSlider">
      <span id="limitXValue">0</span>
      <button onclick="animateLimit()">Animate Approach</button>
      <button onclick="showLeftRightLimits()">Show Left/Right Limits</button>
    </div>
    
    <div class="calculations" id="limitCalculations">
      <div>Approaching \( x \): <span id="limitX">0</span></div>
      <div>Current \( y \): <span id="limitY">0</span></div>
      <div>Limit: <span id="limitValue">0</span></div>
      <div id="leftRightLimits" style="display: none;">
        Left-hand limit: <span id="leftLimit">0</span><br>
        Right-hand limit: <span id="rightLimit">0</span>
      </div>
    </div>
    
    <div class="canvas-container">
      <canvas id="limitCanvas" width="500" height="350"></canvas>
    </div>
    
    <div class="step-by-step">
      <h4>Step-by-Step: Evaluating Limits</h4>
      <ol>
        <li>Try direct substitution: plug the value into the function</li>
        <li>If direct substitution fails (0/0, ∞/∞, etc.), try algebraic manipulation</li>
        <li>For one-sided limits, approach from only the left or only the right</li>
        <li>If the left and right limits match, the limit exists</li>
      </ol>
    </div>
  </div>

  <!-- Derivatives Section -->
  <div id="derivative" class="concept section">
    <h2>4. Derivatives</h2>
    <p>
      The derivative represents the instantaneous rate of change of a function at a specific point. It's the slope of the tangent line to the curve at that point.
    </p>
    
    <div class="formula">
      \[ f'(x) = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h} \]
    </div>
    
    <div class="explanation">
      <h3>Derivative Notation</h3>
      <p>Derivatives can be represented in several ways:</p>
      <ul>
        <li>Lagrange's notation: \( f'(x) \)</li>
        <li>Leibniz's notation: \( \frac{dy}{dx} \) or \( \frac{df}{dx} \)</li>
        <li>Newton's notation: \( \dot{y} \) (for time derivatives)</li>
      </ul>
    </div>
    
    <div class="controls">
      <label>Select function: </label>
      <select id="derivativeFunctionSelect">
        <option value="quadratic">Quadratic \( (x^2) \)</option>
        <option value="cubic">Cubic \( (x^3) \)</option>
        <option value="sinusoidal">Sinusoidal \( (\sin(x)) \)</option>
        <option value="exponential">Exponential \( (e^x) \)</option>
      </select>
      <label>Select point on curve: </label>
      <input type="range" min="-5" max="5" value="0" step="0.1" class="slider" id="derivativeSlider">
      <span id="derivativeXValue">0</span>
      <button onclick="showTangentLine()">Show Tangent Line</button>
      <button onclick="showDerivativeFunction()">Show Derivative Function</button>
    </div>
    
    <div class="calculations" id="derivativeCalculations">
      <div>Current \( x \): <span id="derivX">0</span></div>
      <div>Current \( y \): <span id="derivY">0</span></div>
      <div>Derivative \( \frac{dy}{dx} \): <span id="derivValue">0</span></div>
      <div>Tangent Line: <span id="tangentEquation">\( 0 \)</span></div>
    </div>
    
    <div class="canvas-container">
      <canvas id="derivativeCanvas" width="500" height="350"></canvas>
    </div>
    
    <div class="step-by-step">
      <h4>Step-by-Step: Calculating Derivatives</h4>
      <p>Using the limit definition:</p>
      <ol>
        <li>Start with \( f(x) \)</li>
        <li>Compute \( f(x+h) \)</li>
        <li>Form the difference quotient: \( \frac{f(x+h) - f(x)}{h} \)</li>
        <li>Take the limit as \( h \) approaches 0</li>
        <li>Simplify the expression</li>
      </ol>
    </div>
    
    <div class="real-world">
      <h4>Real-World Example: Velocity</h4>
      <p>If this graph represented position over time, the derivative would represent instantaneous velocity at a specific moment.</p>
    </div>
  </div>

  <!-- Applications Section -->
  <div id="applications" class="concept section">
    <h2>5. Applications of Derivatives</h2>
    <p>Derivatives have numerous practical applications across various fields. Let's explore some key applications.</p>
    
    <div class="explanation">
      <h3>Optimization Problems</h3>
      <p>Derivatives help find maximum and minimum values of functions, which is useful in:</p>
      <ul>
        <li>Maximizing profit or minimizing cost in business</li>
        <li>Finding optimal dimensions for containers</li>
        <li>Determining the best path or strategy</li>
      </ul>
      
      <div class="controls">
        <label>Select optimization problem: </label>
        <select id="optimizationSelect" onchange="showOptimizationProblem()">
          <option value="maxArea">Maximize Area with Fixed Perimeter</option>
          <option value="minCost">Minimize Cost</option>
          <option value="maxVolume">Maximize Volume</option>
        </select>
      </div>
      
      <div id="optimizationProblem" class="calculations">
        <p><strong>Problem:</strong> A farmer has 100 meters of fencing and wants to enclose a rectangular area. What dimensions maximize the area?</p>
        <p><strong>Solution:</strong></p>
        <ol>
          <li>Let length = x, width = y</li>
          <li>Perimeter: 2x + 2y = 100 → y = 50 - x</li>
          <li>Area: A = x * y = x(50 - x) = 50x - x²</li>
          <li>Derivative: A' = 50 - 2x</li>
          <li>Set derivative to 0: 50 - 2x = 0 → x = 25</li>
          <li>Then y = 50 - 25 = 25</li>
          <li>Maximum area is 25 × 25 = 625 m²</li>
        </ol>
      </div>
    </div>
    
    <div class="real-world">
      <h3>Related Rates</h3>
      <p>Related rates problems involve finding the rate at which one quantity changes with respect to time, given the rate of change of another related quantity.</p>
      
      <div class="controls">
        <label>Select related rates problem: </label>
        <select id="ratesSelect" onchange="showRatesProblem()">
          <option value="ladder">Sliding Ladder</option>
          <option value="balloon">Inflating Balloon</option>
          <option value="shadow">Moving Shadow</option>
        </select>
      </div>
      
      <div id="ratesProblem" class="calculations">
        <p><strong>Problem:</strong> A 10-foot ladder is leaning against a wall. The bottom is pulled away at 1 ft/s. How fast is the top sliding down when the bottom is 6 feet from the wall?</p>
        <p><strong>Solution:</strong></p>
        <ol>
          <li>Let x = distance from wall, y = height on wall</li>
          <li>x² + y² = 100 (Pythagorean theorem)</li>
          <li>Differentiate with respect to time: 2x(dx/dt) + 2y(dy/dt) = 0</li>
          <li>We know dx/dt = 1 ft/s, x = 6 ft, so y = √(100-36) = 8 ft</li>
          <li>Substitute: 2(6)(1) + 2(8)(dy/dt) = 0</li>
          <li>12 + 16(dy/dt) = 0 → dy/dt = -12/16 = -0.75 ft/s</li>
          <li>The top is sliding down at 0.75 ft/s</li>
        </ol>
      </div>
    </div>
    
    <div class="step-by-step">
      <h3>Motion Problems</h3>
      <p>In physics, derivatives describe motion:</p>
      <table class="comparison-table">
        <tr>
          <th>Function</th>
          <th>First Derivative</th>
          <th>Second Derivative</th>
        </tr>
        <tr>
          <td>Position: s(t)</td>
          <td>Velocity: v(t) = s'(t)</td>
          <td>Acceleration: a(t) = v'(t) = s''(t)</td>
        </tr>
      </table>
      
      <div class="controls">
        <label>Select motion function: </label>
        <select id="motionSelect" onchange="showMotionProblem()">
          <option value="freeFall">Free Fall</option>
          <option value="harmonic">Harmonic Motion</option>
          <option value="projectile">Projectile Motion</option>
        </select>
      </div>
      
      <div id="motionProblem" class="calculations">
        <p><strong>Problem:</strong> An object is dropped from a height of 100 meters. Its position is given by s(t) = 100 - 4.9t². Find its velocity and acceleration after 2 seconds.</p>
        <p><strong>Solution:</strong></p>
        <ol>
          <li>Position: s(t) = 100 - 4.9t²</li>
          <li>Velocity: v(t) = s'(t) = -9.8t</li>
          <li>At t=2: v(2) = -9.8×2 = -19.6 m/s (downward)</li>
          <li>Acceleration: a(t) = v'(t) = -9.8 m/s² (constant acceleration due to gravity)</li>
        </ol>
      </div>
    </div>
  </div>

  <!-- Practice Problems Section -->
  <div id="practice" class="concept section">
    <h2>6. Practice Problems</h2>
    <p>Test your understanding with these practice problems. Try to solve them on your own before checking the solution!</p>
    
    <div class="controls">
      <button onclick="changeProblemType('slope')">Slope Problems</button>
      <button onclick="changeProblemType('rate')">Rate of Change</button>
      <button onclick="changeProblemType('limit')">Limits</button>
      <button onclick="changeProblemType('derivative')">Derivatives</button>
      <button onclick="changeProblemType('application')">Applications</button>
    </div>
    
    <div class="section" id="problemContainer">
      <h3 id="problemTitle">Basic Slope Problems</h3>
      <div id="currentProblem" class="calculations"></div>
      <div class="controls">
        <input type="text" id="userAnswer" placeholder="Enter your answer" class="p-2 border rounded">
        <button onclick="checkAnswer()">Check Answer</button>
        <button onclick="showSolution()">Show Solution</button>
        <button onclick="nextProblem()">Next Problem</button>
        <button onclick="hint()">Hint</button>
      </div>
      <div id="hint" class="calculations" style="display: none;"></div>
      <div id="feedback" class="calculations" style="display: none;"></div>
      <div id="solution" class="calculations" style="display: none;"></div>
    </div>
    
    <div class="real-world">
      <h3>Challenge Problems</h3>
      <p>For those who want an extra challenge:</p>
      <div id="challengeProblems" class="calculations">
        <p><strong>1.</strong> Find the derivative of \( f(x) = x^x \)</p>
        <p><strong>2.</strong> A particle moves along a curve defined by \( y = x^3 - 3x \). At what points is the tangent line horizontal?</p>
        <p><strong>3.</strong> Evaluate \( \lim_{x \to 0} \frac{\sin(3x)}{\sin(5x)} \)</p>
      </div>
    </div>
  </div>

  <script>
    // Update progress bar based on current section
    const sections = ['introduction', 'basic', 'change', 'limit', 'derivative', 'applications', 'practice'];
    
    function updateProgressBar() {
      const currentSection = document.querySelector('.concept.active').id;
      const currentIndex = sections.indexOf(currentSection);
      const progress = (currentIndex / (sections.length - 1)) * 100;
      document.getElementById('progressBar').style.width = `${progress}%`;
    }
    
    // Helper function to update MathJax rendering.
    function updateMath() {
      if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise();
      }
    }

    // Get canvas contexts for drawing
    const slopeCtx = document.getElementById('slopeCanvas').getContext('2d');
    const rateCtx = document.getElementById('rateCanvas').getContext('2d');
    const limitCtx = document.getElementById('limitCanvas').getContext('2d');
    const derivativeCtx = document.getElementById('derivativeCanvas').getContext('2d');

    // Utility functions for transforming coordinates
    function transformX(x, canvas) {
      return canvas.width / 2 + x * 20;
    }
    function transformY(y, canvas) {
      return canvas.height / 2 - y * 20;
    }

    // Draw coordinate system on a given canvas context
    function drawCoordinateSystem(ctx) {
      const canvas = ctx.canvas;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.beginPath();
      // X-axis
      ctx.moveTo(0, canvas.height / 2);
      ctx.lineTo(canvas.width, canvas.height / 2);
      // Y-axis
      ctx.moveTo(canvas.width / 2, 0);
      ctx.lineTo(canvas.width / 2, canvas.height);
      ctx.strokeStyle = '#000';
      ctx.stroke();

      // Draw grid lines
      ctx.strokeStyle = '#ddd';
      ctx.beginPath();
      for (let x = -10; x <= 10; x++) {
        if (x === 0) continue;
        const screenX = transformX(x, canvas);
        ctx.moveTo(screenX, 0);
        ctx.lineTo(screenX, canvas.height);
      }
      for (let y = -7; y <= 7; y++) {
        if (y === 0) continue;
        const screenY = transformY(y, canvas);
        ctx.moveTo(0, screenY);
        ctx.lineTo(canvas.width, screenY);
      }
      ctx.stroke();
      
      // Label axes
      ctx.fillStyle = '#000';
      ctx.font = '12px Arial';
      ctx.fillText('x', canvas.width - 10, canvas.height / 2 - 10);
      ctx.fillText('y', canvas.width / 2 + 10, 10);
      
      // Add scale markers
      for (let x = -10; x <= 10; x += 2) {
        if (x === 0) continue;
        const screenX = transformX(x, canvas);
        ctx.fillText(x.toString(), screenX - 5, canvas.height / 2 + 15);
      }
      for (let y = -7; y <= 7; y += 2) {
        if (y === 0) continue;
        const screenY = transformY(y, canvas);
        ctx.fillText(y.toString(), canvas.width / 2 + 5, screenY + 5);
      }
    }

    // Basic Slopes Section
    function drawSlope() {
      const slope = math.evaluate(document.getElementById('slopeSlider').value + '/5');
      document.getElementById('slopeValue').textContent = slope;
      const rise = math.evaluate('2 * ' + slope);
      const run = 2;
      document.getElementById('riseValue').textContent = rise.toFixed(2);
      document.getElementById('runValue').textContent = run;
      document.getElementById('slopeMValue').textContent = slope.toFixed(2);
      // Wrap the dynamic content with LaTeX delimiters
      document.getElementById('slopeEquation').innerHTML = `\\(y = ${slope.toFixed(2)}x\\)`;
      drawCoordinateSystem(slopeCtx);
      slopeCtx.beginPath();
      slopeCtx.moveTo(0, transformY(-10 * slope, slopeCtx.canvas));
      slopeCtx.lineTo(slopeCtx.canvas.width, transformY(10 * slope, slopeCtx.canvas));
      slopeCtx.strokeStyle = '#007bff';
      slopeCtx.lineWidth = 2;
      slopeCtx.stroke();
      
      // Draw rise and run
      slopeCtx.beginPath();
      slopeCtx.moveTo(transformX(0, slopeCtx.canvas), transformY(0, slopeCtx.canvas));
      slopeCtx.lineTo(transformX(run, slopeCtx.canvas), transformY(0, slopeCtx.canvas));
      slopeCtx.strokeStyle = 'green';
      slopeCtx.lineWidth = 2;
      slopeCtx.stroke();
      
      slopeCtx.beginPath();
      slopeCtx.moveTo(transformX(run, slopeCtx.canvas), transformY(0, slopeCtx.canvas));
      slopeCtx.lineTo(transformX(run, slopeCtx.canvas), transformY(rise, slopeCtx.canvas));
      slopeCtx.strokeStyle = 'red';
      slopeCtx.lineWidth = 2;
      slopeCtx.stroke();
      
      // Draw points
      slopeCtx.beginPath();
      slopeCtx.arc(transformX(0, slopeCtx.canvas), transformY(0, slopeCtx.canvas), 5, 0, Math.PI * 2);
      slopeCtx.fillStyle = 'blue';
      slopeCtx.fill();
      
      slopeCtx.beginPath();
      slopeCtx.arc(transformX(run, slopeCtx.canvas), transformY(rise, slopeCtx.canvas), 5, 0, Math.PI * 2);
      slopeCtx.fillStyle = 'blue';
      slopeCtx.fill();
      
      updateMath();
    }
    
    function addPointToSlope() {
      const slope = math.evaluate(document.getElementById('slopeSlider').value + '/5');
      const run = 2;
      const rise = math.evaluate('2 * ' + slope);
      document.getElementById('pointCoordinates').innerHTML = 
        `Point A: (0, 0)<br>Point B: (${run}, ${rise.toFixed(2)})`;
    }

    // Rate of Change Section
    function calculateY(x, type) {
      switch(type) {
        case 'quadratic':
          return math.evaluate('x^2/4', {x});
        case 'cubic':
          return math.evaluate('x^3/16', {x});
        case 'sinusoidal':
          return math.sin(x);
        case 'exponential':
          return math.exp(x/2);
        case 'logarithmic':
          return x !== 0 ? Math.log(Math.abs(x)) : NaN;
        default:
          return 0;
      }
    }
    
    function drawFunction() {
      const functionType = document.getElementById('functionSelect').value;
      const x1 = parseFloat(document.getElementById('pointASlider').value);
      const x2 = parseFloat(document.getElementById('pointBSlider').value);
      document.getElementById('pointAValue').textContent = x1.toFixed(1);
      document.getElementById('pointBValue').textContent = x2.toFixed(1);
      
      const y1 = calculateY(x1, functionType);
      const y2 = calculateY(x2, functionType);
      const avgRate = (y2 - y1) / (x2 - x1);
      
      document.getElementById('pointAX').textContent = x1.toFixed(1);
      document.getElementById('pointAY').textContent = y1.toFixed(2);
      document.getElementById('pointBX').textContent = x2.toFixed(1);
      document.getElementById('pointBY').textContent = y2.toFixed(2);
      document.getElementById('rateRise').textContent = (y2 - y1).toFixed(2);
      document.getElementById('rateRun').textContent = (x2 - x1).toFixed(1);
      document.getElementById('averageRate').textContent = avgRate.toFixed(2);
      
      drawCoordinateSystem(rateCtx);
      rateCtx.beginPath();
      rateCtx.strokeStyle = '#007bff';
      rateCtx.lineWidth = 2;
      for (let t = -10; t <= 10; t += 0.1) {
        const yVal = calculateY(t, functionType);
        if (isNaN(yVal)) continue;
        const screenX = transformX(t, rateCtx.canvas);
        const screenY = transformY(yVal, rateCtx.canvas);
        if (t === -10 || isNaN(calculateY(t-0.1, functionType))) {
          rateCtx.moveTo(screenX, screenY);
        } else {
          rateCtx.lineTo(screenX, screenY);
        }
      }
      rateCtx.stroke();
      
      // Draw secant line
      rateCtx.beginPath();
      rateCtx.strokeStyle = 'red';
      rateCtx.lineWidth = 2;
      const m = avgRate;
      const b = y1 - m * x1;
      rateCtx.moveTo(transformX(-10, rateCtx.canvas), transformY(m*(-10)+b, rateCtx.canvas));
      rateCtx.lineTo(transformX(10, rateCtx.canvas), transformY(m*10+b, rateCtx.canvas));
      rateCtx.stroke();
      
      // Highlight the points
      rateCtx.beginPath();
      rateCtx.arc(transformX(x1, rateCtx.canvas), transformY(y1, rateCtx.canvas), 5, 0, Math.PI * 2);
      rateCtx.fillStyle = 'red';
      rateCtx.fill();
      
      rateCtx.beginPath();
      rateCtx.arc(transformX(x2, rateCtx.canvas), transformY(y2, rateCtx.canvas), 5, 0, Math.PI * 2);
      rateCtx.fillStyle = 'red';
      rateCtx.fill();
      
      updateMath();
    }

    // Limits Section
    let limitAnimation;
    
    function calculateLimitY(x, type) {
      switch(type) {
        case 'continuous':
          return math.evaluate('x^2/4', {x});
        case 'discontinuous':
          return x !== 2 ? math.evaluate('(x^2-4)/(x-2)', {x}) : NaN;
        case 'oscillating':
          return x !== 0 ? math.evaluate('sin(1/x)', {x}) : NaN;
        default:
          return 0;
      }
    }
    
    function animateLimit() {
      const targetX = parseFloat(document.getElementById('limitSlider').value);
      const functionType = document.getElementById('limitFunctionSelect').value;
      let currentX = targetX - 2;
      if (limitAnimation) {
        cancelAnimationFrame(limitAnimation);
      }
      
      function animate() {
        const y = calculateLimitY(currentX, functionType);
        const limitY = calculateLimitY(targetX, functionType);
        document.getElementById('limitX').textContent = currentX.toFixed(4);
        document.getElementById('limitY').textContent = isNaN(y) ? 'undefined' : y.toFixed(4);
        document.getElementById('limitValue').textContent = isNaN(limitY) ? 'undefined' : limitY.toFixed(4);
        drawCoordinateSystem(limitCtx);
        limitCtx.beginPath();
        limitCtx.strokeStyle = '#007bff';
        limitCtx.lineWidth = 2;
        for (let x = -10; x <= 10; x += 0.05) {
          const yVal = calculateLimitY(x, functionType);
          if (isNaN(yVal)) continue;
          const screenX = transformX(x, limitCtx.canvas);
          const screenY = transformY(yVal, limitCtx.canvas);
          if (x === -10 || isNaN(calculateLimitY(x-0.05, functionType))) {
            limitCtx.moveTo(screenX, screenY);
          } else {
            limitCtx.lineTo(screenX, screenY);
          }
        }
        limitCtx.stroke();
        
        // Draw approaching point
        if (!isNaN(y)) {
          limitCtx.beginPath();
          limitCtx.arc(transformX(currentX, limitCtx.canvas), transformY(y, limitCtx.canvas), 5, 0, Math.PI * 2);
          limitCtx.fillStyle = 'red';
          limitCtx.fill();
        }
        
        currentX += (targetX - currentX) * 0.05;
        updateMath();
        if (Math.abs(currentX - targetX) > 0.01) {
          limitAnimation = requestAnimationFrame(animate);
        }
      }
      animate();
    }
    
    function showLeftRightLimits() {
      const targetX = parseFloat(document.getElementById('limitSlider').value);
      const functionType = document.getElementById('limitFunctionSelect').value;
      
      const leftLimit = calculateLimitY(targetX - 0.001, functionType);
      const rightLimit = calculateLimitY(targetX + 0.001, functionType);
      
      document.getElementById('leftLimit').textContent = isNaN(leftLimit) ? 'undefined' : leftLimit.toFixed(4);
      document.getElementById('rightLimit').textContent = isNaN(rightLimit) ? 'undefined' : rightLimit.toFixed(4);
      document.getElementById('leftRightLimits').style.display = 'block';
    }

    // Derivatives Section
    function calculateDerivativeY(x, type) {
      switch(type) {
        case 'quadratic':
          return math.evaluate('x^2/4', {x});
        case 'cubic':
          return math.evaluate('x^3/16', {x});
        case 'sinusoidal':
          return math.sin(x);
        case 'exponential':
          return math.exp(x/2);
        default:
          return 0;
      }
    }
    
    function calculateDerivative(x, type) {
      switch(type) {
        case 'quadratic':
          return math.evaluate('x/2', {x});
        case 'cubic':
          return math.evaluate('3*x^2/16', {x});
        case 'sinusoidal':
          return math.cos(x);
        case 'exponential':
          return math.evaluate('exp(x/2)/2', {x});
        default:
          return 0;
      }
    }
    
    function showTangentLine() {
      const functionType = document.getElementById('derivativeFunctionSelect').value;
      const x = parseFloat(document.getElementById('derivativeSlider').value);
      document.getElementById('derivativeXValue').textContent = x.toFixed(1);
      
      const y = calculateDerivativeY(x, functionType);
      const derivative = calculateDerivative(x, functionType);
      document.getElementById('derivX').textContent = x.toFixed(2);
      document.getElementById('derivY').textContent = y.toFixed(2);
      document.getElementById('derivValue').textContent = derivative.toFixed(2);
      // Wrap tangent equation in LaTeX delimiters
      document.getElementById('tangentEquation').innerHTML = `\\(y = ${derivative.toFixed(2)}(x - ${x.toFixed(2)}) + ${y.toFixed(2)}\\)`;
      drawCoordinateSystem(derivativeCtx);
      derivativeCtx.beginPath();
      derivativeCtx.strokeStyle = '#007bff';
      derivativeCtx.lineWidth = 2;
      for (let t = -10; t <= 10; t += 0.1) {
        const yVal = calculateDerivativeY(t, functionType);
        const screenX = transformX(t, derivativeCtx.canvas);
        const screenY = transformY(yVal, derivativeCtx.canvas);
        if (t === -10) {
          derivativeCtx.moveTo(screenX, screenY);
        } else {
          derivativeCtx.lineTo(screenX, screenY);
        }
      }
      derivativeCtx.stroke();
      
      // Draw tangent line
      const x1 = x - 2;
      const x2 = x + 2;
      const y1 = math.evaluate('y - derivative * 2', {y, derivative});
      const y2 = math.evaluate('y + derivative * 2', {y, derivative});
      derivativeCtx.beginPath();
      derivativeCtx.strokeStyle = 'red';
      derivativeCtx.lineWidth = 2;
      derivativeCtx.moveTo(transformX(x1, derivativeCtx.canvas), transformY(y1, derivativeCtx.canvas));
      derivativeCtx.lineTo(transformX(x2, derivativeCtx.canvas), transformY(y2, derivativeCtx.canvas));
      derivativeCtx.stroke();
      
      // Highlight the point
      derivativeCtx.beginPath();
      derivativeCtx.arc(transformX(x, derivativeCtx.canvas), transformY(y, derivativeCtx.canvas), 5, 0, Math.PI * 2);
      derivativeCtx.fillStyle = 'red';
      derivativeCtx.fill();
      updateMath();
    }
    
    function showDerivativeFunction() {
      const functionType = document.getElementById('derivativeFunctionSelect').value;
      const x = parseFloat(document.getElementById('derivativeSlider').value);
      
      drawCoordinateSystem(derivativeCtx);
      
      // Draw original function
      derivativeCtx.beginPath();
      derivativeCtx.strokeStyle = '#007bff';
      derivativeCtx.lineWidth = 2;
      for (let t = -10; t <= 10; t += 0.1) {
        const yVal = calculateDerivativeY(t, functionType);
        const screenX = transformX(t, derivativeCtx.canvas);
        const screenY = transformY(yVal, derivativeCtx.canvas);
        if (t === -10) {
          derivativeCtx.moveTo(screenX, screenY);
        } else {
          derivativeCtx.lineTo(screenX, screenY);
        }
      }
      derivativeCtx.stroke();
      
      // Draw derivative function
      derivativeCtx.beginPath();
      derivativeCtx.strokeStyle = 'green';
      derivativeCtx.lineWidth = 2;
      for (let t = -10; t <= 10; t += 0.1) {
        const yVal = calculateDerivative(t, functionType);
        const screenX = transformX(t, derivativeCtx.canvas);
        const screenY = transformY(yVal, derivativeCtx.canvas);
        if (t === -10) {
          derivativeCtx.moveTo(screenX, screenY);
        } else {
          derivativeCtx.lineTo(screenX, screenY);
        }
      }
      derivativeCtx.stroke();
      
      // Add legend
      derivativeCtx.fillStyle = '#007bff';
      derivativeCtx.fillText('f(x)', 20, 30);
      derivativeCtx.fillStyle = 'green';
      derivativeCtx.fillText("f'(x)", 20, 50);
      
      updateMath();
    }

    // Applications Section
    function showOptimizationProblem() {
      const problemType = document.getElementById('optimizationSelect').value;
      let problemHTML = '';
      
      switch(problemType) {
        case 'maxArea':
          problemHTML = `
            <p><strong>Problem:</strong> A farmer has 100 meters of fencing and wants to enclose a rectangular area. What dimensions maximize the area?</p>
            <p><strong>Solution:</strong></p>
            <ol>
              <li>Let length = x, width = y</li>
              <li>Perimeter: 2x + 2y = 100 → y = 50 - x</li>
              <li>Area: A = x * y = x(50 - x) = 50x - x²</li>
              <li>Derivative: A' = 50 - 2x</li>
              <li>Set derivative to 0: 50 - 2x = 0 → x = 25</li>
              <li>Then y = 50 - 25 = 25</li>
              <li>Maximum area is 25 × 25 = 625 m²</li>
            </ol>
          `;
          break;
        case 'minCost':
          problemHTML = `
            <p><strong>Problem:</strong> A company needs to produce cylindrical cans with volume 500 cm³. The material for the sides costs $0.02/cm², and for the top and bottom $0.05/cm². Find the dimensions that minimize cost.</p>
            <p><strong>Solution:</strong></p>
            <ol>
              <li>Let radius = r, height = h</li>
              <li>Volume: πr²h = 500 → h = 500/(πr²)</li>
              <li>Cost: C = 0.05(2πr²) + 0.02(2πrh) = 0.1πr² + 0.04πr(500/(πr²)) = 0.1πr² + 20/r</li>
              <li>Derivative: C' = 0.2πr - 20/r²</li>
              <li>Set derivative to 0: 0.2πr - 20/r² = 0 → 0.2πr³ = 20 → r³ = 100/π → r ≈ 3.17 cm</li>
              <li>Then h = 500/(π(3.17)²) ≈ 15.85 cm</li>
              <li>Minimum cost is achieved with r ≈ 3.17 cm, h ≈ 15.85 cm</li>
            </ol>
          `;
          break;
        case 'maxVolume':
          problemHTML = `
            <p><strong>Problem:</strong> From a square sheet of cardboard 24 cm on a side, equal squares are cut from the corners and the sides are folded up to form an open box. What size squares should be cut to maximize volume?</p>
            <p><strong>Solution:</strong></p>
            <ol>
              <li>Let x = side of square cut from each corner</li>
              <li>Box dimensions: length = 24 - 2x, width = 24 - 2x, height = x</li>
              <li>Volume: V = x(24 - 2x)² = 4x(12 - x)²</li>
              <li>Derivative: V' = 4(12 - x)² - 8x(12 - x) = 4(12 - x)(12 - x - 2x) = 4(12 - x)(12 - 3x)</li>
              <li>Set derivative to 0: x = 12 or x = 4</li>
              <li>x = 12 is not possible, so x = 4 cm</li>
              <li>Maximum volume is V = 4(4)(12 - 4)² = 16 × 64 = 1024 cm³</li>
            </ol>
          `;
          break;
      }
      
      document.getElementById('optimizationProblem').innerHTML = problemHTML;
      updateMath();
    }
    
    function showRatesProblem() {
      const problemType = document.getElementById('ratesSelect').value;
      let problemHTML = '';
      
      switch(problemType) {
        case 'ladder':
          problemHTML = `
            <p><strong>Problem:</strong> A 10-foot ladder is leaning against a wall. The bottom is pulled away at 1 ft/s. How fast is the top sliding down when the bottom is 6 feet from the wall?</p>
            <p><strong>Solution:</strong></p>
            <ol>
              <li>Let x = distance from wall, y = height on wall</li>
              <li>x² + y² = 100 (Pythagorean theorem)</li>
              <li>Differentiate with respect to time: 2x(dx/dt) + 2y(dy/dt) = 0</li>
              <li>We know dx/dt = 1 ft/s, x = 6 ft, so y = √(100-36) = 8 ft</li>
              <li>Substitute: 2(6)(1) + 2(8)(dy/dt) = 0</li>
              <li>12 + 16(dy/dt) = 0 → dy/dt = -12/16 = -0.75 ft/s</li>
              <li>The top is sliding down at 0.75 ft/s</li>
            </ol>
          `;
          break;
        case 'balloon':
          problemHTML = `
            <p><strong>Problem:</strong> A spherical balloon is inflated at a rate of 10 cm³/s. How fast is the radius increasing when the radius is 5 cm?</p>
            <p><strong>Solution:</strong></p>
            <ol>
              <li>Volume: V = (4/3)πr³</li>
              <li>Differentiate with respect to time: dV/dt = 4πr²(dr/dt)</li>
              <li>We know dV/dt = 10 cm³/s, r = 5 cm</li>
              <li>Substitute: 10 = 4π(5)²(dr/dt)</li>
              <li>10 = 100π(dr/dt)</li>
              <li>dr/dt = 10/(100π) = 1/(10π) ≈ 0.0318 cm/s</li>
              <li>The radius is increasing at about 0.0318 cm/s</li>
            </ol>
          `;
          break;
        case 'shadow':
          problemHTML = `
            <p><strong>Problem:</strong> A 6-foot tall person walks away from a 10-foot lamp post at 4 ft/s. How fast is the tip of their shadow moving?</p>
            <p><strong>Solution:</strong></p>
            <ol>
              <li>Let x = distance from person to post, y = length of shadow</li>
              <li>By similar triangles: 10/(x+y) = 6/y</li>
              <li>Cross multiply: 10y = 6(x+y) → 10y = 6x + 6y → 4y = 6x → y = 1.5x</li>
              <li>Distance from post to tip of shadow: s = x + y = x + 1.5x = 2.5x</li>
              <li>Differentiate: ds/dt = 2.5(dx/dt)</li>
              <li>We know dx/dt = 4 ft/s, so ds/dt = 2.5 × 4 = 10 ft/s</li>
              <li>The tip of the shadow is moving at 10 ft/s</li>
            </ol>
          `;
          break;
      }
      
      document.getElementById('ratesProblem').innerHTML = problemHTML;
      updateMath();
    }
    
    function showMotionProblem() {
      const problemType = document.getElementById('motionSelect').value;
      let problemHTML = '';
      
      switch(problemType) {
        case 'freeFall':
          problemHTML = `
            <p><strong>Problem:</strong> An object is dropped from a height of 100 meters. Its position is given by s(t) = 100 - 4.9t². Find its velocity and acceleration after 2 seconds.</p>
            <p><strong>Solution:</strong></p>
            <ol>
              <li>Position: s(t) = 100 - 4.9t²</li>
              <li>Velocity: v(t) = s'(t) = -9.8t</li>
              <li>At t=2: v(2) = -9.8×2 = -19.6 m/s (downward)</li>
              <li>Acceleration: a(t) = v'(t) = -9.8 m/s² (constant acceleration due to gravity)</li>
            </ol>
          `;
          break;
        case 'harmonic':
          problemHTML = `
            <p><strong>Problem:</strong> A mass on a spring oscillates with position s(t) = 2cos(3t). Find its velocity and acceleration at t = π/6.</p>
            <p><strong>Solution:</strong></p>
            <ol>
              <li>Position: s(t) = 2cos(3t)</li>
              <li>Velocity: v(t) = s'(t) = -6sin(3t)</li>
              <li>At t=π/6: v(π/6) = -6sin(π/2) = -6 m/s</li>
              <li>Acceleration: a(t) = v'(t) = -18cos(3t)</li>
              <li>At t=π/6: a(π/6) = -18cos(π/2) = 0 m/s²</li>
            </ol>
          `;
          break;
        case 'projectile':
          problemHTML = `
            <p><strong>Problem:</strong> A projectile is launched with initial velocity 50 m/s at 30° to horizontal. Its horizontal position is x(t) = 50cos(30°)t and vertical position is y(t) = 50sin(30°)t - 4.9t². Find the velocity components and speed at t=2s.</p>
            <p><strong>Solution:</strong></p>
            <ol>
              <li>Horizontal position: x(t) = 50×(√3/2)×t ≈ 43.3t</li>
              <li>Vertical position: y(t) = 50×(1/2)×t - 4.9t² = 25t - 4.9t²</li>
              <li>Horizontal velocity: v_x(t) = x'(t) ≈ 43.3 m/s (constant)</li>
              <li>Vertical velocity: v_y(t) = y'(t) = 25 - 9.8t</li>
              <li>At t=2: v_y(2) = 25 - 19.6 = 5.4 m/s</li>
              <li>Speed: √(v_x² + v_y²) = √(43.3² + 5.4²) ≈ √(1875 + 29) ≈ √1904 ≈ 43.6 m/s</li>
            </ol>
          `;
          break;
      }
      
      document.getElementById('motionProblem').innerHTML = problemHTML;
      updateMath();
    }

    // Navigation function to switch between sections
    function showConcept(conceptId) {
      document.querySelectorAll('.concept').forEach(el => {
        el.classList.remove('active');
      });
      document.getElementById(conceptId).classList.add('active');
      updateProgressBar();
      
      switch(conceptId) {
        case 'introduction':
          // No special initialization needed
          break;
        case 'basic':
          drawSlope();
          break;
        case 'change':
          drawFunction();
          break;
        case 'limit':
          drawCoordinateSystem(limitCtx);
          updateMath();
          break;
        case 'derivative':
          showTangentLine();
          break;
        case 'applications':
          showOptimizationProblem();
          showRatesProblem();
          showMotionProblem();
          break;
        case 'practice':
          displayCurrentProblem();
          break;
      }
    }

    // Practice Problems Section
    const problemSets = {
      slope: [
        {
          question: "Find the slope of a line passing through points (2, 5) and (4, 9).",
          answer: 2,
          solution: "Rise = 9 - 5 = 4\nRun = 4 - 2 = 2\nSlope = \\(\\frac{4}{2} = 2\\)",
          hint: "Remember that slope = (change in y) / (change in x)"
        },
        {
          question: "A line has a y-intercept of 3 and passes through the point (2, 7). What is its slope?",
          answer: 2,
          solution: "Rise = 7 - 3 = 4\nRun = 2 - 0 = 2\nSlope = \\(\\frac{4}{2} = 2\\)",
          hint: "The y-intercept gives you the point (0, 3)"
        },
        {
          question: "If a line has a slope of -3 and passes through (0, 4), what is the y-coordinate when \\(x = 2\\)?",
          answer: -2,
          solution: "Using \\(y = mx + b\\):\n\\(y = -3(2) + 4 = -6 + 4 = -2\\)",
          hint: "Use the slope-intercept form: y = mx + b"
        }
      ],
      rate: [
        {
          question: "A ball is thrown upward with an initial velocity of 20 m/s. Given \\(h(t) = -4.9t^2 + 20t\\), find the instantaneous velocity at \\(t = 1\\) second.",
          answer: 10.2,
          solution: "Differentiate \\(h(t)\\) to obtain \\(h'(t) = -9.8t + 20\\).\nAt \\(t = 1\\): \\(h'(1) = -9.8 + 20 = 10.2 \\text{ m/s}\\).",
          hint: "Velocity is the derivative of position with respect to time"
        },
        {
          question: "The population \\(P(t) = 1000(1.1)^t\\) represents bacteria count. Find the average rate of change from \\(t = 0\\) to \\(t = 2\\).",
          answer: 210,
          solution: "Average rate = \\(\\frac{P(2) - P(0)}{2}\\) = \\(\\frac{1000(1.1)^2 - 1000}{2} = \\frac{1210 - 1000}{2} = 210\\)",
          hint: "Average rate of change = (f(b) - f(a)) / (b - a)"
        }
      ],
      limit: [
        {
          question: "Evaluate \\(\\lim_{x \\to 2} \\frac{x^2 - 4}{x - 2}\\).",
          answer: 4,
          solution: "Factor the numerator: \\(x^2-4=(x+2)(x-2)\\). Cancel \\(x-2\\) to get \\(x+2\\).\nThen, \\(x+2 = 4\\) when \\(x = 2\\).",
          hint: "Try factoring the numerator"
        },
        {
          question: "Evaluate \\(\\lim_{x \\to 0} \\frac{\\sin(x)}{x}\\).",
          answer: 1,
          solution: "It is a standard limit: \\(\\lim_{x \\to 0} \\frac{\\sin(x)}{x} = 1\\).",
          hint: "This is a standard limit you should memorize"
        },
        {
          question: "Evaluate \\(\\lim_{x \\to 3} \\frac{x^2 - 9}{x - 3}\\).",
          answer: 6,
          solution: "Factor \\(x^2-9=(x-3)(x+3)\\). Cancel \\(x-3\\) and substitute \\(x=3\\) to get \\(3+3=6\\).",
          hint: "Try factoring the numerator"
        },
        {
          question: "Evaluate \\(\\lim_{x \\to 0} \\frac{1-\\cos(x)}{x^2}\\).",
          answer: 0.5,
          solution: "Using the standard limit \\(\\lim_{x \\to 0}\\frac{1-\\cos(x)}{x^2} = \\frac{1}{2}\\), the answer is \\(0.5\\).",
          hint: "This is another standard limit"
        }
      ],
      derivative: [
        {
          question: "Find \\(\\frac{dy}{dx}\\) for \\(y = x^3 - 2x^2 + 3x - 1\\).",
          answer: "3x^2 - 4x + 3",
          solution: "Differentiate each term: \\(\\frac{d}{dx}(x^3)=3x^2\\), \\(\\frac{d}{dx}(2x^2)=4x\\), \\(\\frac{d}{dx}(3x)=3\\).\nThus, \\(\\frac{dy}{dx} = 3x^2 - 4x + 3\\).",
          hint: "Use the power rule for each term"
        },
        {
          question: "Find the derivative of \\(y = \\sin(x)\\cos(x)\\).",
          answer: "cos^2(x) - sin^2(x)",
          solution: "Using the product rule: \\(y' = \\sin(x)(-\\sin(x)) + \\cos(x)\\cos(x) = \\cos^2(x) - \\sin^2(x)\\).",
          hint: "Use the product rule: (fg)' = f'g + fg'"
        },
        {
          question: "Find the derivative of \\(y = 2x^2 + 3x - 5\\).",
          answer: "4x + 3",
          solution: "Differentiate term-by-term: \\(\\frac{d}{dx}(2x^2)=4x\\), \\(\\frac{d}{dx}(3x)=3\\), and the derivative of a constant is 0. Hence, \\(y' = 4x + 3\\).",
          hint: "Use the power rule for each term"
        },
        {
          question: "Find the derivative of \\(y = \\ln(x)\\).",
          answer: "1/x",
          solution: "The derivative of \\(\\ln(x)\\) is \\(\\frac{1}{x}\\).",
          hint: "This is a standard derivative"
        },
        {
          question: "Find the derivative of \\(y = e^x\\).",
          answer: "e^x",
          solution: "The derivative of \\(e^x\\) is \\(e^x\\).",
          hint: "This is a special property of the exponential function"
        }
      ],
      application: [
        {
          question: "A rectangular field is to be enclosed with 100 m of fencing. If the length is x meters, express the area A as a function of x and find the value of x that maximizes the area.",
          answer: "25",
          solution: "Let width = y. Perimeter: 2x + 2y = 100 → y = 50 - x\nArea: A = x(50 - x) = 50x - x²\nDerivative: A' = 50 - 2x\nSet A' = 0: 50 - 2x = 0 → x = 25\nMaximum area when x = 25 m",
          hint: "First express the area in terms of x, then find the derivative"
        },
        {
          question: "A ball is thrown upward with velocity 20 m/s from a height of 10 m. Its height is h(t) = -4.9t² + 20t + 10. When does it reach maximum height?",
          answer: "2.04",
          solution: "Velocity is derivative of height: v(t) = h'(t) = -9.8t + 20\nSet v(t) = 0: -9.8t + 20 = 0 → t = 20/9.8 ≈ 2.04 s\nMaximum height at t ≈ 2.04 s",
          hint: "Maximum height occurs when velocity is zero"
        }
      ]
    };

    let currentProblemType = 'slope';
    let currentProblemIndex = 0;

    function changeProblemType(type) {
      currentProblemType = type;
      currentProblemIndex = 0;
      displayCurrentProblem();
      document.getElementById('problemTitle').textContent = type.charAt(0).toUpperCase() + type.slice(1) + ' Problems';
      document.getElementById('hint').style.display = 'none';
      document.getElementById('feedback').style.display = 'none';
      document.getElementById('solution').style.display = 'none';
    }

    function displayCurrentProblem() {
      const problem = problemSets[currentProblemType][currentProblemIndex];
      document.getElementById('currentProblem').innerHTML = problem.question;
      document.getElementById('feedback').style.display = 'none';
      document.getElementById('solution').style.display = 'none';
      document.getElementById('hint').style.display = 'none';
      document.getElementById('userAnswer').value = '';
      updateMath();
    }

    function checkAnswer() {
      const userAnswer = document.getElementById('userAnswer').value;
      const problem = problemSets[currentProblemType][currentProblemIndex];
      const feedback = document.getElementById('feedback');
      const isCorrect = typeof problem.answer === 'number'
        ? Math.abs(parseFloat(userAnswer) - problem.answer) < 0.1
        : userAnswer.toLowerCase().replace(/\s+/g, '') === problem.answer.toLowerCase().replace(/\s+/g, '');
      feedback.style.display = 'block';
      feedback.innerHTML = isCorrect 
        ? '<span style="color: green">Correct! Well done!</span>' 
        : '<span style="color: red">Not quite right. Try again or view the solution.</span>';
      updateMath();
    }

    function showSolution() {
      const solution = document.getElementById('solution');
      solution.style.display = 'block';
      solution.textContent = problemSets[currentProblemType][currentProblemIndex].solution;
      updateMath();
    }
    
    function hint() {
      const hint = document.getElementById('hint');
      hint.style.display = 'block';
      hint.textContent = "Hint: " + problemSets[currentProblemType][currentProblemIndex].hint;
    }

    function nextProblem() {
      currentProblemIndex = (currentProblemIndex + 1) % problemSets[currentProblemType].length;
      displayCurrentProblem();
    }

    // Add slider event listeners for real-time updates
    document.getElementById('slopeSlider').addEventListener('input', drawSlope);
    document.getElementById('pointASlider').addEventListener('input', drawFunction);
    document.getElementById('pointBSlider').addEventListener('input', drawFunction);
    document.getElementById('functionSelect').addEventListener('change', drawFunction);
    document.getElementById('derivativeSlider').addEventListener('input', showTangentLine);
    document.getElementById('derivativeFunctionSelect').addEventListener('change', showTangentLine);
    document.getElementById('limitFunctionSelect').addEventListener('change', function() {
      drawCoordinateSystem(limitCtx);
      updateMath();
    });
    
    // For the limit slider, update the displayed values and redraw the coordinate system
    document.getElementById('limitSlider').addEventListener('input', function() {
      const x = parseFloat(this.value);
      document.getElementById('limitXValue').textContent = x.toFixed(1);
      const functionType = document.getElementById('limitFunctionSelect').value;
      const y = calculateLimitY(x, functionType);
      document.getElementById('limitX').textContent = x.toFixed(4);
      document.getElementById('limitY').textContent = isNaN(y) ? 'undefined' : y.toFixed(4);
      document.getElementById('limitValue').textContent = isNaN(y) ? 'undefined' : y.toFixed(4);
      drawCoordinateSystem(limitCtx);
      limitCtx.beginPath();
      limitCtx.strokeStyle = '#007bff';
      limitCtx.lineWidth = 2;
      for (let t = -10; t <= 10; t += 0.05) {
        const yVal = calculateLimitY(t, functionType);
        if (isNaN(yVal)) continue;
        const screenX = transformX(t, limitCtx.canvas);
        const screenY = transformY(yVal, limitCtx.canvas);
        if (t === -10 || isNaN(calculateLimitY(t-0.05, functionType))) {
          limitCtx.moveTo(screenX, screenY);
        } else {
          limitCtx.lineTo(screenX, screenY);
        }
      }
      limitCtx.stroke();
      updateMath();
    });

    // Initialize all sections
    updateProgressBar();
    drawSlope();
    drawFunction();
    drawCoordinateSystem(limitCtx);
    showTangentLine();
    displayCurrentProblem();
    
    // Initialize applications section
    showOptimizationProblem();
    showRatesProblem();
    showMotionProblem();
  </script>
</body>
</html>
